<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>PabloBeats ‚Äî Loja de M√∫sicas e Free Beats</title>
<meta name="description" content="Envie sua m√∫sica, ou√ßa pr√©vias, compre no WhatsApp e curta beats gr√°tis com visual neon." />
<meta name="theme-color" content="#070716" />
<style>
body{margin:0;background:#070716;color:#fff;font-family:Arial,sans-serif}
.banner{padding:20px;text-align:center;background:#0a0b15;position:sticky;top:0;z-index:10}
h1{margin:0;font-size:28px;color:#d5c6ff;text-shadow:0 0 10px #8b5cf6}
.btn{display:inline-block;padding:8px 12px;background:#8b5cf6;color:#fff;border:none;border-radius:6px;text-decoration:none;margin:5px;cursor:pointer;box-shadow:0 0 10px #8b5cf6,0 0 20px #22d3ee;transition:.3s}
.btn:hover{box-shadow:0 0 20px #8b5cf6,0 0 40px #22d3ee}
.section{padding:15px;margin:15px;background:rgba(255,255,255,.05);border-radius:10px}
.grid{display:grid;gap:12px}
@media(min-width:760px){.grid{grid-template-columns:1fr 1fr}}
.card{padding:10px;background:rgba(255,255,255,.06);border-radius:10px}
.small{opacity:.8;font-size:12px}
input[type=file]{background:#111;color:#fff;border:1px solid #333;border-radius:6px;padding:8px}
.status{margin-top:8px;font-size:14px}
audio{width:100%;margin-top:8px}
.notice{font-size:12px;opacity:.7}
/* Neon Player */
.neon-player{padding:20px;text-align:center;background:#0f0f1a;margin:15px;border-radius:12px;box-shadow:0 0 15px #8b5cf6,0 0 30px #22d3ee}
.neon-player h2{text-shadow:0 0 10px #8b5cf6,0 0 20px #22d3ee}
.neon-track{margin:10px 0;padding:10px;background:#111;border-radius:8px;box-shadow:0 0 10px #8b5cf6}
</style>
</head>
<body>
<section class="banner">
  <h1>PabloBeats</h1>
  <a class="btn" href="http://www.pablologomarcas.online">‚Üê Voltar ao PabloLogos</a>
</section>

<main class="container">

  <section class="neon-player">
    <h2>üéµ Free Beats Neon Player</h2>
    <div id="neonPlaylist"></div>
  </section>

  <section class="section">
    <h3>Enviar sua m√∫sica (salva na pasta <code>musicas/</code>)</h3>
    <form id="uploadForm" enctype="multipart/form-data" method="post" action="upload.php">
      <input type="file" name="musica" accept="audio/*" required>
      <button type="submit" class="btn">Enviar M√∫sica</button>
      <div class="status" id="uploadStatus"></div>
      <div class="notice">Formatos aceitos: mp3, wav, ogg, flac, m4a, aac, wma. At√© 64MB.</div>
    </form>
  </section>

  <section class="section">
    <h3>M√∫sicas dispon√≠veis para venda</h3>
    <div class="grid" id="musicasVenda"></div>
    <div class="small">Pr√©via limitada a 40 segundos. Para comprar o arquivo completo, use o bot√£o do WhatsApp em cada m√∫sica.</div>
  </section>

</main>

<script>
const WHATSAPP_NUMBER = "5534998110946";

function formatBytes(bytes) {
  if (bytes === 0) return '0 B';
  const k = 1024;
  const sizes = ['B','KB','MB','GB','TB'];
  const i = Math.floor(Math.log(bytes)/Math.log(k));
  return parseFloat((bytes/Math.pow(k,i)).toFixed(2))+' '+sizes[i];
}

// Neon free tracks
const freeTracks = [
  {title:"Free Beat 1 - Trap", url:"https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3"},
  {title:"Free Beat 2 - Drill", url:"https://www.soundhelix.com/examples/mp3/SoundHelix-Song-2.mp3"},
  {title:"Free Beat 3 - LoFi", url:"https://www.soundhelix.com/examples/mp3/SoundHelix-Song-3.mp3"},
  {title:"Free Beat 4 - BoomBap", url:"https://www.soundhelix.com/examples/mp3/SoundHelix-Song-4.mp3"},
  {title:"Free Beat 5 - Afro", url:"https://www.soundhelix.com/examples/mp3/SoundHelix-Song-5.mp3"}
];
const neonContainer = document.getElementById('neonPlaylist');
freeTracks.forEach(track => {
  const div = document.createElement('div');
  div.className = 'neon-track';
  div.innerHTML = `<strong>${track.title}</strong><br><audio controls preload="none" src="${track.url}"></audio>`;
  neonContainer.appendChild(div);
});

// Carregar m√∫sicas enviadas
async function carregarMusicas() {
  try {
    const resp = await fetch('listar.php?ts=' + Date.now());
    const lista = await resp.json();
    const container = document.getElementById('musicasVenda');
    container.innerHTML = '';

    if (!Array.isArray(lista) || lista.length === 0) {
      container.innerHTML = '<div class="small">Nenhuma m√∫sica enviada ainda.</div>';
      return;
    }

    lista.sort((a,b) => (b.mtime||0)-(a.mtime||0));

    for (const m of lista) {
      const card = document.createElement('div');
      card.className = 'card';

      const watext = encodeURIComponent(`Tenho interesse na m√∫sica: ${m.nome}`);
      const waLink = `https://wa.me/${WHATSAPP_NUMBER}?text=${watext}`;

      card.innerHTML = `
        <strong>${m.nome}</strong>
        <div class="small">${formatBytes(m.size||0)}</div>
        <audio preload="metadata" controls src="${m.url}"></audio>
        <div>
          <a class="btn" href="${waLink}" target="_blank" rel="noopener">Comprar no WhatsApp</a>
        </div>
        <div class="notice">A reprodu√ß√£o √© limitada a 40 segundos nesta p√°gina.</div>
      `;

      const audio = card.querySelector('audio');
      audio.addEventListener('timeupdate', () => {
        if (audio.currentTime >= 40) {
          audio.pause();
          audio.currentTime = 0;
        }
      });
      audio.addEventListener('seeking', () => {
        if (audio.currentTime > 40) {
          audio.currentTime = 0;
          audio.pause();
        }
      });

      container.appendChild(card);
    }
  } catch (e) {
    console.error(e);
    document.getElementById('musicasVenda').innerHTML = '<div class="small">Erro ao carregar lista.</div>';
  }
}
document.addEventListener('DOMContentLoaded', carregarMusicas);

// Upload com feedback
const form = document.getElementById('uploadForm');
const statusEl = document.getElementById('uploadStatus');
form.addEventListener('submit', async (ev) => {
  ev.preventDefault();
  const formData = new FormData(form);
  statusEl.textContent = 'Enviando...';

  try {
    const r = await fetch('upload.php', { method: 'POST', body: formData });
    const raw = await r.text();
    let data = null;
    try { data = JSON.parse(raw); } catch (e) {}

    if (!r.ok) {
      statusEl.textContent = '‚ùå Falha HTTP ' + r.status + ' ‚Äî ' + (raw?.slice(0,140) || 'sem resposta');
      return;
    }

    if (!data) {
      statusEl.textContent = '‚ùå Resposta inesperada do servidor (n√£o-JSON).';
      console.error('Resposta:', raw);
      return;
    }

    if (data.ok) {
      statusEl.textContent = '‚úÖ Upload realizado com sucesso!';
      form.reset();
      carregarMusicas();
    } else {
      statusEl.textContent = '‚ùå ' + (data.msg || 'Erro no upload');
      if (data.dir) statusEl.textContent += ' (Pasta: ' + data.dir + ')';
    }
  } catch (e) {
    console.error(e);
    statusEl.textContent = '‚ùå Erro de rede ao enviar (verifique se o PHP est√° ativo no servidor).';
  }
});
</script>
</body>
</html>
